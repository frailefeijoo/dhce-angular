<dhce-mat-expansion-component
  title="Connections"
  summary="Configuración de conexiones de BBDD"
  [expanded]="isPanelExpanded"
  (expandedChange)="onPanelExpandedChange($event)"
>
  <div expansion-header-actions class="connection-active-select" (click)="$event.stopPropagation()">
    <label for="activeConnectionSelect">Conexión activa</label>
    <select
      id="activeConnectionSelect"
      [disabled]="!canSelectActiveConnection"
      [value]="activeConnectionName"
      (click)="$event.stopPropagation()"
      (change)="onActiveConnectionChange($any($event.target).value)"
    >
      <option value="">Sin conexión activa</option>
      @for (connection of structuredConnections; track connection.name) {
        <option [value]="connection.name">{{ connection.name }}</option>
      }
    </select>
  </div>

  <p>El origen de conexión se determina automáticamente por la extensión del fichero.</p>

  <dhce-mat-input
    type="string"
    label="Origen de conexión"
    hint="Campo autocalculado según extensión del fichero seleccionado."
    [readonly]="true"
    [default]="detectedConnectionSourceLabel"
  ></dhce-mat-input>

  <div class="connection-file-row">
    <div class="connection-file-input">
      <dhce-mat-input
        type="file"
        label="Fichero de conexión"
        [hint]="connectionFileHint"
        [required]="true"
        [validate]="true"
        [businessValid]="connectionFileBusinessValid"
        [businessError]="connectionFileBusinessError"
        [default]="connectionFilePath"
        [pickerResolver]="connectionPickerResolver"
        (valueChange)="onConnectionFileChange($event)"
      ></dhce-mat-input>
    </div>

    <div class="connection-file-status" aria-live="polite">
      @if (isValidatingConnectionFile) {
        <dhce-mat-progress-spinner-component [diameter]="20" [strokeWidth]="3"></dhce-mat-progress-spinner-component>
      } @else if (connectionFileBusinessValid === true) {
        <dhce-mat-icon-component class="status-icon status-icon-ok" icon="check_circle" ariaLabel="Fichero validado"></dhce-mat-icon-component>
      } @else if (connectionFileBusinessValid === false && hasConnectionFileValue) {
        <dhce-mat-icon-component class="status-icon status-icon-error" icon="error" ariaLabel="Fichero inválido"></dhce-mat-icon-component>
      }
    </div>
  </div>
</dhce-mat-expansion-component>
